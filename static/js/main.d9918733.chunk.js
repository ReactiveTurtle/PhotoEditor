(this["webpackJsonpphoto-editor"]=this["webpackJsonpphoto-editor"]||[]).push([[0],[,,,,,function(t,e,n){},,,,,,,function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e){},function(t,e,n){"use strict";n.r(e);var i=n(3),o=n(0),c=n(1),l=n.n(c),s=n(6),a=n.n(s),r=(n(5),n(2));n(12),n(13);var u=function(t){return Object(o.jsx)("div",{className:"Button"+(null!=t.class?" "+t.class:""),onClick:t.onClick,children:t.text})};n(14);function d(t,e){var n=new ImageData(e.x,e.y);return n.data.fill(255),Object(i.a)(Object(i.a)({},t),{},{selectedObject:null,canvas:n})}var x;n(15);function y(t){return Object(o.jsxs)("div",{className:"EditText-input",children:[Object(o.jsx)("input",{className:"Number-input",id:t.id,type:t.type,min:"1",defaultValue:t.text,placeholder:t.hintText,onChange:function(e){return t.onChange(e)}}),Object(o.jsx)("label",{className:"Number-label",htmlFor:"newWidth",children:t.title})]})}function f(){var t=document.getElementById("SelectSizePopup-out");null!=t&&t.classList.add("hidden")}function h(){var t=Object(c.useState)({x:600,y:400}),e=Object(r.a)(t,1)[0];return Object(o.jsx)("div",{className:"SelectSizePopup-out hidden",id:"SelectSizePopup-out",onClick:function(t){t.defaultPrevented||f()},children:Object(o.jsxs)("div",{className:"SelectSizePopup",onClick:function(t){t.preventDefault()},children:[Object(o.jsx)("p",{className:"SelectSizePopup-title",children:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0440\u0430\u0437\u043c\u0435\u0440 \u0445\u043e\u043b\u0441\u0442\u0430"}),Object(o.jsx)(y,{title:"\u0428\u0438\u0440\u0438\u043d\u0430",onChange:function(t){return e.x=parseInt(t.target.value)},text:e.x+"",type:"number",hintText:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0447\u0438\u0441\u043b\u043e"}),Object(o.jsx)(y,{title:"\u0412\u044b\u0441\u043e\u0442\u0430",onChange:function(t){return e.y=parseInt(t.target.value)},text:e.y+"",type:"number",hintText:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0447\u0438\u0441\u043b\u043e"}),Object(o.jsx)("div",{className:"SelectSizePopup-buttonWrapper",children:Object(o.jsx)(u,{text:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c",onClick:function(){I(d(W(),e)),f()}})})]})})}function p(t,e,n){var i;switch(n.type){case x.Polygon:i=function(t,e,n){t.beginPath(),t.moveTo(n.position.x+n.points[0].x,n.position.y+n.points[0].y),n.points.forEach((function(e){t.lineTo(n.position.x+e.x,n.position.y+e.y)})),t.lineTo(n.position.x+n.points[0].x,n.position.y+n.points[0].y),n.points.length>1&&t.lineTo(n.position.x+n.points[1].x,n.position.y+n.points[1].y);t.fillStyle=n.fillColor,t.fill(),t.beginPath(),t.lineWidth=n.strokeWidth,t.moveTo(n.position.x+n.points[0].x,n.position.y+n.points[0].y),n.points.forEach((function(e){t.lineTo(n.position.x+e.x,n.position.y+e.y)})),t.lineTo(n.position.x+n.points[0].x,n.position.y+n.points[0].y),n.points.length>1&&t.lineTo(n.position.x+n.points[1].x,n.position.y+n.points[1].y);return t.strokeStyle=n.strokeColor,t.stroke(),t.getImageData(0,0,e.x,e.y)}(t,e,n);break;case x.Circle:i=function(t,e,n){var i=n.strokeWidth/2;return t.lineWidth=n.strokeWidth,t.beginPath(),t.arc(n.position.x+n.radius,n.position.y+n.radius,n.radius+i,0,2*Math.PI,!1),t.strokeStyle=n.strokeColor,t.stroke(),t.beginPath(),t.arc(n.position.x+n.radius,n.position.y+n.radius,n.radius,0,2*Math.PI,!1),t.fillStyle=n.fillColor,t.fill(),t.getImageData(0,0,e.x,e.y)}(t,e,n);break;case x.Art:i=function(t,e,n){return t.putImageData(n.image,n.position.x,n.position.y),t.getImageData(0,0,e.x,e.y)}(t,e,n);break;case x.TextObject:i=function(t,e,n){return t.font="".concat(n.size.y,"px monospace"),t.fillStyle=n.color,t.fillText(n.text,n.position.x,n.position.y,n.size.x),t.getImageData(0,0,e.x,e.y)}(t,e,n)}if(void 0===i)throw new Error;return i}!function(t){t[t.Art=0]="Art",t[t.Circle=1]="Circle",t[t.Polygon=2]="Polygon",t[t.TextObject=3]="TextObject"}(x||(x={}));n(16),n(17);var j=function(){return Object(o.jsx)("div",{className:"ColorPicker",children:Object(o.jsxs)("div",{children:[Object(o.jsx)(y,{id:"EditText-fill",title:"\u0426\u0432\u0435\u0442 \u0437\u0430\u043b\u0438\u0432\u043a\u0438",text:"#424242",type:"color",onChange:function(t){var e=t.target,n=W(),i=n.selectedObject;if(null!=i&&(i.type===x.Polygon||i.type===x.Circle)){var o=i;o.fillColor=e.value,n.selectedObject=null,I(n),I(M(o)),e.onchange=null,D()}}}),Object(o.jsx)(y,{id:"EditText-stroke",title:"\u0426\u0432\u0435\u0442 \u043a\u043e\u043d\u0442\u0443\u0440\u0430",text:"#888888",type:"color",onChange:function(t){var e=t.target,n=W(),i=n.selectedObject;if(null!=i&&(i.type===x.Polygon||i.type===x.Circle)){var o=i;o.strokeColor=e.value,n.selectedObject=null,I(n),I(M(o)),e.onchange=null,D()}}})]})})};function b(){return document.getElementById("EditText-fill").value}function v(){return document.getElementById("EditText-stroke").value}var g;n(18);function O(t){var e=t.onSelected,n=Object(c.useState)(g.Rectangle),i=Object(r.a)(n,2),l=i[0],s=i[1];Object(c.useEffect)((function(){e(l)}),[e,l]);var a=function(t){s(t),D()};return Object(o.jsxs)("div",{className:"Tools-container",children:[Object(o.jsx)(u,{text:"\u041f\u0440\u044f\u043c\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a",class:l===g.Rectangle?"Tools-selected":"Tools-default",onClick:function(){return a(g.Rectangle)}}),Object(o.jsx)(u,{text:"\u0422\u0440\u0435\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a",class:l===g.Triangle?"Tools-selected":"Tools-default",onClick:function(){return a(g.Triangle)}}),Object(o.jsx)(u,{text:"\u041a\u0440\u0443\u0433",class:l===g.Circle?"Tools-selected":"Tools-default",onClick:function(){return a(g.Circle)}}),Object(o.jsx)(u,{text:"\u0422\u0435\u043a\u0441\u0442",class:l===g.Text?"Tools-selected":"Tools-default",onClick:function(){return a(g.Text)}})]})}function m(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W(),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=document.getElementById("canvas");if(null!=n){var i=n.getContext("2d");null!=i&&(i.putImageData(t.canvas,0,0),null!=t.selectedObject&&(i.putImageData(p(i,{x:n.width,y:n.height},t.selectedObject),0,0),C(t.selectedObject.position,t.selectedObject.size,i)),null!=e&&i.putImageData(p(i,{x:n.width,y:n.height},e),0,0))}}function C(t,e,n){n.setLineDash([15,20]),n.beginPath(),n.lineWidth=5;var i=Math.min(t.y+e.y,t.y);n.moveTo(t.x-n.lineWidth,i-n.lineWidth),n.lineTo(t.x+e.x+n.lineWidth,i-n.lineWidth),n.lineTo(t.x+e.x+n.lineWidth,i+Math.abs(e.y)+n.lineWidth),n.lineTo(t.x-n.lineWidth,i+Math.abs(e.y)+n.lineWidth),n.lineTo(t.x-n.lineWidth,i-n.lineWidth),n.lineWidth=2,n.strokeStyle="#888",n.stroke(),n.setLineDash([])}!function(t){t[t.Rectangle=0]="Rectangle",t[t.Triangle=1]="Triangle",t[t.Circle=2]="Circle",t[t.Text=3]="Text"}(g||(g={}));var T=function(t){var e=t.tool,n=Object(c.useState)(!1),i=Object(r.a)(n,2),l=i[0],s=i[1],a=Object(c.useState)(null),u=Object(r.a)(a,2),d=u[0],y=u[1],f=Object(c.useState)({x:0,y:0}),h=Object(r.a)(f,2),p=h[0],j=h[1],O=W();Object(c.useEffect)((function(){m(W(),d)}),[d]);var C=function(t){if(l){var n=null;switch(e){case g.Rectangle:n=function(t,e){var n={x:Math.min(t.x,e.x),y:Math.min(t.y,e.y)},i={x:Math.max(t.x,e.x),y:Math.max(t.y,e.y)};return{type:x.Polygon,position:n,size:{x:i.x-n.x,y:i.y-n.y},points:[{x:0,y:0},{x:i.x-n.x,y:0},{x:i.x-n.x,y:i.y-n.y},{x:0,y:i.y-n.y}],fillColor:b(),strokeColor:v(),strokeWidth:4}}(p,t);break;case g.Triangle:n=function(t,e){var n={x:Math.min(t.x,e.x),y:t.y},i={x:Math.max(t.x,e.x),y:e.y};return{type:x.Polygon,position:n,size:{x:i.x-n.x,y:i.y-n.y},points:[{x:0,y:0},{x:i.x-n.x,y:0},{x:(i.x-n.x)/2,y:i.y-n.y}],fillColor:b(),strokeColor:v(),strokeWidth:4}}(p,t);break;case g.Circle:n=function(t,e){var n=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));return{type:x.Circle,position:{x:t.x-n,y:t.y-n},size:{x:2*n,y:2*n},radius:n,fillColor:b(),strokeColor:v(),strokeWidth:4}}(p,t)}y(n)}};return Object(o.jsx)("div",{className:"Canvas-container",children:Object(o.jsx)("canvas",{id:"canvas",className:"Canvas",width:O.canvas.width,height:O.canvas.height,onMouseDown:function(t){var e=t.target;"move"===e.style.cursor?null!=O.selectedObject&&j({x:t.clientX-e.offsetLeft-O.selectedObject.position.x,y:t.clientY-e.offsetTop-O.selectedObject.position.y}):(null!=W().selectedObject&&(I(M(null)),S(W().canvas)),j({x:t.clientX-e.offsetLeft,y:t.clientY-e.offsetTop})),s(!0)},onMouseMove:function(t){var e=t.target,n={x:t.clientX-e.offsetLeft,y:t.clientY-e.offsetTop};if(l)if("move"===e.style.cursor){var i=W();null!=i.selectedObject&&(i.selectedObject.position={x:n.x-p.x,y:n.y-p.y},I(i))}else C(n);else{var o=W().selectedObject;if(null!=o){var c=Math.min(o.position.y+o.size.y,o.position.y);n.x>=o.position.x&&n.x<=o.position.x+o.size.x&&n.y>=c&&n.y<=c+Math.abs(o.size.y)?e.style.cursor="move":e.style.cursor="default"}else e.style.cursor="default"}},onMouseUp:function(t){var e=t.target;null!=d?(I(M(d)),y(null)):"default"===e.style.cursor&&null!=W().selectedObject&&(I(M(d)),S(W().canvas)),s(!1)}})})};n(19);var k=function(){var t=Object(c.useState)(g.Rectangle),e=Object(r.a)(t,2),n=e[0],l=e[1];return Object(c.useEffect)((function(){var t=function(t){t.ctrlKey&&(console.log(t.code),"KeyZ"===t.code?I(function(){var t=w.canvas;if(P.history.length>0&&(P.currentHistoryPosition>0||null!=w.selectedObject)){if(null==w.selectedObject)P.currentHistoryPosition--;else{var e=M(null);S(e.canvas),P.currentHistoryPosition--,I(e)}t=E(P.history[P.currentHistoryPosition])}return Object(i.a)(Object(i.a)({},w),{},{canvas:t})}()):"KeyB"===t.code&&I(function(){var t=Object(i.a)({},w);P.history.length>0&&P.currentHistoryPosition<P.history.length-1&&(P.currentHistoryPosition++,t.canvas=E(P.history[P.currentHistoryPosition]));return t}()))};return window.addEventListener("keypress",t),function(){window.removeEventListener("keypress",t)}})),Object(o.jsxs)("div",{className:"App",id:"App",children:[Object(o.jsx)(T,{tool:n}),Object(o.jsxs)("div",{className:"App-scrollContent",children:[Object(o.jsxs)("header",{className:"App-header",children:[Object(o.jsx)(u,{text:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c",onClick:function(){var t=document.getElementById("SelectSizePopup-out");null!=t&&(console.log("click"),t.classList.remove("hidden"))}}),Object(o.jsx)(u,{text:"\u0418\u043c\u043f\u043e\u0440\u0442",onClick:function(){}}),Object(o.jsx)(u,{text:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",onClick:function(){!function(){var t=document.getElementById("canvas");null!=t&&t.toBlob((function(t){if(null!=t){var e=window.URL.createObjectURL(new Blob([t])),n=document.createElement("a");n.href=e,n.setAttribute("download","image.png"),document.body.appendChild(n),n.click(),n.remove()}}),"image/png",.9)}()}})]}),Object(o.jsx)(O,{onSelected:function(t){l(t)}})]}),Object(o.jsx)(j,{}),Object(o.jsx)(h,{})]})},P={history:[],currentHistoryPosition:0};function S(t){for(;P.currentHistoryPosition<P.history.length-1;)P.history.pop();P.currentHistoryPosition===P.history.length-1&&P.currentHistoryPosition++,P.history.push(t)}var w={selectedObject:null,canvas:new ImageData(600,400)};function I(t){w=t,console.log(P.history.length+", "+P.currentHistoryPosition),m()}function E(t){var e=new ImageData(t.width,t.height);return e.data.set(new Uint8ClampedArray(t.data)),e}function W(){return{selectedObject:w.selectedObject,canvas:E(w.canvas)}}function M(t){var e=Object(i.a)(Object(i.a)({},w),{},{selectedObject:t});if(null!=w.selectedObject){var n=document.getElementById("canvas");if(null!=n){var o=n.getContext("2d");null!=o&&(o.putImageData(w.canvas,0,0),e.canvas=p(o,{x:w.canvas.width,y:w.canvas.height},w.selectedObject))}}return e}function D(){a.a.render(Object(o.jsx)(l.a.StrictMode,{children:Object(o.jsx)(k,{})}),document.getElementById("root"))}var N=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,21)).then((function(e){var n=e.getCLS,i=e.getFID,o=e.getFCP,c=e.getLCP,l=e.getTTFB;n(t),i(t),o(t),c(t),l(t)}))};I(d(W(),{x:400,y:600})),S(W().canvas),D(),N()}],[[20,1,2]]]);
//# sourceMappingURL=main.d9918733.chunk.js.map